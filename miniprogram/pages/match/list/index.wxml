<view class="container">

<block wx:if="{{isLoggedIn}}">
  <view class="add-box">
    <input class="link-input" placeholder=" 粘贴 Pokernow 对局链接" bindinput="onInputLink" value="{{inputLink}}"></input>
    <view class="add-btn" bindtap="createMatch" hover-class="btn-hover">新建</view>
  </view>

  <scroll-view scroll-y class="list-area">
    <block wx:for="{{matchList}}" wx:key="_id">
      <movable-area class="swipe-area">
        <movable-view class="swipe-content" direction="horizontal" inertia="true" out-of-bounds="true" damping="100" x="{{item.x}}" data-index="{{index}}" bindtouchend="onSwipeEnd" disabled="{{!isAdmin}}">
          
          <view class="swipe-wrapper">
            
            <view class="card-outer">
              <view class="card">
                <view class="card-header">
                  <text class="match-name">{{item.name}}</text>
                  <view class="status-tag {{item.status=='记录中' ? 'running' : (item.status=='已暂停' ? 'paused' : 'ended')}}">
                    <view wx:if="{{item.status=='记录中'}}" class="dot"></view>
                    {{item.status}}
                  </view>
                </view>

                <view class="data-panel">
                  <view class="data-row">
                    <view class="icon-wrap">
                      <image class="data-icon" src="https://img.icons8.com/ios-glyphs/60/000000/time.png"></image>
                    </view>
                    
                    <block wx:if="{{item.status == '已结束'}}">
                      <text class="data-text">{{item.realStartTime || item.createTime}} ~ {{item.realEndTime || '?'}}</text>
                    </block>
                    <block wx:else>
                      <text class="data-text">{{item.realStartTime || item.createTime}}<text wx:if="{{item.status=='记录中'}}" class="running-text"> Running...</text></text>
                    </block>
                  </view>

                  <view class="data-row">
                    <view class="icon-wrap">
                      <image class="data-icon" src="https://img.icons8.com/ios-glyphs/60/000000/activity-feed.png"></image>
                    </view>
                    <text class="data-text bold">Hand #{{item.currentHandNumber}}</text>
                  </view>
                </view>

                <view class="action-row">
                  
                  <view class="action-left">
                    <view class="btn-capsule blue" bindtap="viewMatch" data-id="{{item.gameId}}" hover-class="capsule-hover">详情</view>
                    <view class="btn-capsule purple" catchtap="goToBind" data-id="{{item.gameId}}" hover-class="capsule-hover">绑定</view>
                  </view>

                  <view class="action-right">
                    <view 
                      wx:if="{{item.status !== '已结束'}}" 
                      class="btn-capsule {{item.status=='记录中' ? 'orange' : 'green'}}" 
                      bindtap="toggleUpdate" 
                      data-index="{{index}}" 
                      hover-class="capsule-hover"
                    >
                      {{item.status=='记录中' ? '暂停' : '更新'}}
                    </view>

                    <view 
                      wx:if="{{item.status !== '记录中' && item.status !== '已结束'}}" 
                      class="btn-capsule red" 
                      bindtap="endMatch" 
                      data-id="{{item.gameId}}" 
                      hover-class="capsule-hover"
                    >
                      结束
                    </view>
                  </view>

                </view> </view>
            </view>

            <view class="delete-btn center" catchtap="deleteMatch" data-id="{{item.gameId}}" data-index="{{index}}">删除</view>
          
          </view>
        </movable-view>
      </movable-area>
    </block>
    <view style="height: 40rpx;"></view>
  </scroll-view>
</block>

<view class="empty-state" wx:else>
  <image class="empty-icon" src="https://img.icons8.com/ios/100/cccccc/lock.png"></image>
  <view class="empty-text">请登录后查看对局记录</view>
  <button class="login-jump-btn" bindtap="goToProfile">去登录</button>
</view>

</view>