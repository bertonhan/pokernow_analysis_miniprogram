<view class="page-wrap">
  <view class="panel header-panel">
    <view class="page-title">线下格局录入</view>
    <view class="page-subtitle">顶部填写本次格局名称，左侧 gejuId，右侧录入成绩</view>

    <view class="name-row">
      <text class="name-label">本次格局名称</text>
      <input
        class="name-input"
        placeholder="例如：3.1德扑周末之战"
        value="{{matchName}}"
        bindinput="onInputMatchName"
      />
    </view>
  </view>

  <view class="panel table-panel">
    <view class="table-header">
      <view class="table-title">玩家 gejuId 与成绩</view>
      <view class="refresh-btn" bindtap="onRefreshPlayers">刷新ID</view>
    </view>

    <view class="table-loading" wx:if="{{loadingPlayers}}">正在加载 gejuId...</view>
    <view class="table-error" wx:if="{{!loadingPlayers && loadError}}">{{loadError}}</view>

    <scroll-view
      wx:if="{{!loadingPlayers && players.length > 0}}"
      class="table-scroll"
      scroll-y="true"
      enhanced="true"
      show-scrollbar="false"
    >
      <block wx:for="{{players}}" wx:key="gejuId">
        <view class="table-row {{item.invalid ? 'row-invalid' : ''}}">
          <view class="left-col">
            <text class="row-index">{{index + 1}}.</text>
            <text class="geju-id">{{item.gejuId}}</text>
          </view>
          <input
            class="score-input"
            type="text"
            placeholder="+100 / -100"
            value="{{item.netInput}}"
            data-index="{{index}}"
            bindinput="onInputNet"
          />
        </view>
      </block>
    </scroll-view>

    <view class="empty-box" wx:if="{{!loadingPlayers && players.length === 0 && !loadError}}">
      当前没有已注册 gejuId，请先到“我的”页注册用户信息。
    </view>

    <view class="summary-row">
      <view class="summary-chip">已填写：{{filledCount}} 人</view>
      <view class="summary-chip">异常输入：{{invalidCount}}</view>
      <view class="summary-chip sum-chip">合计：{{sumNet}}</view>
    </view>
    <view class="summary-tip">已加载 ID：{{totalPlayers}} 个（自动读取 users 集合）</view>
  </view>

  <view
    class="submit-btn {{submitting ? 'submit-btn-disabled' : ''}}"
    bindtap="onCreateManualMatch"
  >
    {{submitting ? '创建中...' : '创建线下格局'}}
  </view>
</view>
